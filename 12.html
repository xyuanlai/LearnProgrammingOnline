<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by TEMPLATED
http://templated.co
Released for free under the Creative Commons Attribution License

Name       : LawnLike
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20131202

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<!-- level -->
<script src="./blockly_compressed.js"></script>
<script src="./blocks_compressed.js"></script>
<script src="./javascript_compressed.js"></script>
<script src="./msg/js/zh-hant.js"></script>
<link rel="stylesheet" href="./css/level_view.css">
<link rel="stylesheet" href="./jquery-ui-1.11.4/jquery-ui.css">
<script src="./jquery-ui-1.11.4/external/jquery/jquery.js"></script>
<script src="./jquery-ui-1.11.4/jquery-ui.js"></script>
<!-- level -->
<link href="default.css" rel="stylesheet" type="text/css" media="all" />
<link href="fonts.css" rel="stylesheet" type="text/css" media="all" />
<script src="./promptdemo.js"></script>
<!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->

</head>
<body>
<audio id="winAudio"><source src="./media/win.mp3" type="audio/mpeg"></audio>
<audio id="failureAudio"><source src="./media/failure.mp3" type="audio/mpeg"></audio>
<audio id="clickAudio"><source src="./media/click.mp3" type="audio/mpeg"></audio>
<audio id="correctAudio"><source src="./media/correct.mp3" type="audio/mpeg"></audio>
<audio id="level_12_1Audio"><source src="./media/level_12_1.mp3" type="audio/mpeg"></audio>
<audio id="level_12_2Audio"><source src="./media/level_12_2.mp3" type="audio/mpeg"></audio>
<audio id="level_12_3Audio"><source src="./media/level_12_3.mp3" type="audio/mpeg"></audio>
<div id="header-wrapper">
	<div id="header" class="container">
		<div id="logo">
			<h1><span class="fa fa-bolt"></span><a href="#">Level 12&nbsp;&nbsp;<span style='color:grey'>/13 迴圈及條件判斷</span></a></h1>
		</div>
	</div>
</div>
<div id="header-featured">
	<div id="banner-wrapper">
		<div id="banner" class="container">
			<p>終於突破重重難關快抵達終點了，摧毀石塊以及樹木前往入口前面吧!</p>
			<div style="float:right">
				<table style="width:100%">
					<tr>
						<td>過關最多使用</td>
						<td style="font-size:26px; font-weight:bold;">16</td>
						<td>個積木，你已經使用 </td>
						<td><span id="capacity" style="color:white; font-size:36px; font-weight:bold;"></span></td>
						<td> 個積木</td>
						<td><button onclick="runCode()" id="count" class="button">Run</button></td>
					</tr>
				</table>
			</div>
		</div>
	</div>
</div>
<div id="wrapper">
	<div id="featured-wrapper">
		<div id="featured" class="extra2 margin-btm container">
		<table style="height: 100%; width: 100%;">
			<tr>
				<td style="padding-top: 7px; padding-left: 0px; padding-right: 50px">
					<canvas id="canvas" width="400" height="400"></canvas>
				</td>
				<td style="padding-left: 50px; padding-right: 50px">
					<div id="blocklyDiv"></div>
				</td>
			</tr>
		</table>
			<!-- <div class="ebox1">
				<p><canvas id="canvas" width="400" height="400"></canvas></p>
			</div>
			<div class="ebox2">
				<p><div id="blocklyDiv"></div></p>
			</div> -->
		</div>
	</div>
</div>
</body>
<xml id="toolbox" style="display: none">
		<block type="move_forward"></block>
		<block type="move_turnright"></block>
		<block type="move_turnleft"></block>
		<block type="action_floor"></block>
		<block type="action_destroy"></block>
		<block type="action_destroytree"></block>
		<block type="controls_repeat"></block>
		<block type="general_if"></block>
</xml>
<script>
		var canvas = document.getElementById('canvas');

		// Game objects
		var hero = {
			speed: 5, // movement ms per pixels
			handspeed: 20,
			x: 0,
			y: 350,
			pre: [],
			direction: "right"
		};
		var ore1 = {
			x: 50,
			y: 350,
			show: true,
			live: true
		};
		var ore2 = {
			x: 50,
			y: 300,
			show: true,
			live: true
		};
		var ore3 = {
			x: 150,
			y: 250,
			show: true,
			live: true
		};
		var ore4 = {
			x: 150,
			y: 200,
			show: true,
			live: true
		};
		var ore5 = {
			x: 250,
			y: 150,
			show: true,
			live: true
		};
		var ore6 = {
			x: 250,
			y: 100,
			show: true,
			live: true
		};
		var tree1 = {
			x: 100,
			y: 300,
			show: true,
			live: true
		};
		var tree2 = {
			x: 200,
			y: 200,
			show: true,
			live: true
		};
		var tree3 = {
			x: 300,
			y: 100,
			show: true,
			live: true
		};

		var lava = [[50,300], [150,250],[250,150],[250,100]];
		var wall = [[0,0],[50,0],[100,0],[150,0],[200,0],[250,0],[300,0],[350,0],
		[0,50],[50,50],[100,50],[150,50],[200,50],[250,50],
		[0,100],[50,100],[100,100],[150,100],[200,100],[350,100],
		[0,150],[50,150],[100,150],[150,150],[300,150],[350,150],
		[0,200],[50,200],[100,200],[250,200],[300,200],[350,200],
		[0,250],[50,250],[200,250],[250,250],[300,250],[350,250],
		[0,300],[150,300],[200,300],[250,300],[300,300],[350,300],
		[100,350],[150,350],[200,350],[250,350],[300,350],[350,350]
		];
		var orenum = 6;
		var treenum = 3;
		var builtfloor = [];
		var builtcount = 0;
		var winpoint = 0;
		var failcount = 0;

		var images = {};
		function loadImages(sources, callback) {
			var loadedImages = 0;
			var numImages = 0;
			// get num of sources
			for(var src in sources) {
				numImages++;
			}
			for(var src in sources) {
				images[src] = new Image();
				images[src].onload = function() {
					if(++loadedImages >= numImages) {
						callback(images);
					}
				};
				images[src].src = sources[src];
			}
		}

		var sources = {
			bgImage: './img/grass_12.png',
			herorightImage: './img/YuanRight.png',
			herorightImage1: './img/YuanRight_1.png',
			herorightImage2: './img/YuanRight_2.png',
			herorightImage3: './img/YuanRight_3.png',
			herorightImageLava: './img/YuanRight_lava.png',
			heroleftImage: './img/YuanLeft.png',
			heroleftImage1: './img/YuanLeft_1.png',
			heroleftImage2: './img/YuanLeft_2.png',
			heroleftImage3: './img/YuanLeft_3.png',
			heroupImage: './img/YuanUp.png',
			heroupImage1: './img/YuanUp_1.png',
			heroupImage2: './img/YuanUp_2.png',
			heroupImage3: './img/YuanUp_3.png',
			herodownImage: './img/YuanDown.png',
			herodownImage1: './img/YuanDown_1.png',
			herodownImage2: './img/YuanDown_2.png',
			herodownImage3: './img/YuanDown_3.png',
			floorwoodImage: './img/Wood.png',
			floorstoneImage: './img/Stone.png',
			targetImage: './img/SanTree.png',
			oreImage: './img/Ore.png'
		};

		if (canvas && canvas.getContext) { // does the browser support 'canvas'?
				var context = canvas.getContext("2d"); // get drawing context

		} else {
				alert('You need a browser which supports the HTML5 canvas!');
		}

		var heroImageNow;
		loadImages(sources, function(images) {
			drawNowBackgraound();
			heroImageNow = eval('images.hero' + hero.direction + 'Image');
			context.drawImage(heroImageNow, hero.x, hero.y);
		});

		function drawNowBackgraound(){
			context.drawImage(images.bgImage, 0, 0, canvas.width, canvas.height);
			for(var num = 1; num <= orenum; num++){
				var orex = eval("ore" + num + ".x");
				var orey = eval("ore" + num + ".y");
				var oreshow = eval("ore" + num + ".show");
				if(oreshow){
					context.drawImage(images.oreImage, orex, orey, 50, 50);
				}
			}
			for(var num = 1; num <= treenum; num++){
				var treex = eval("tree" + num + ".x");
				var treey = eval("tree" + num + ".y");
				var treeshow = eval("tree" + num + ".show");
				if(treeshow){
					context.drawImage(images.targetImage, treex, treey, 50, 50);
				}
			}
			for(var b = 0; b < builtcount; b++){
				context.drawImage(images.floorstoneImage, builtfloor[b][0],  builtfloor[b][1], 50, 50);
			}
		}

		function moveForward(id) {
			move(id);
		}

		function turnLeft(id){
			turn(0, id);
		}

		function turnRight(id){
			turn(1, id);
		}

		function move(id){
			if (!isPath()) {
				Blocklylog.push(['fail_forward', id]);
				hero.pre.push([hero.x, hero.y, hero.direction]);
				console.log("Blocklylog push = " + Blocklylog);
				return;
			}
			var command;
			switch (hero.direction) {
				case "up":
					hero.pre.push([hero.x, hero.y, hero.direction]);
					hero.y = hero.y - 50;
					command = 'moveup';
					break;
				case "right":
					hero.pre.push([hero.x, hero.y, hero.direction]);
					hero.x = hero.x + 50;
					command = 'moveright';
					break;
				case "down":
					hero.pre.push([hero.x, hero.y, hero.direction]);
					hero.y = hero.y + 50;
					command = 'movedown';
					break;
				case "left":
					hero.pre.push([hero.x, hero.y, hero.direction]);
					hero.x = hero.x - 50;
					command = 'moveleft';
					break;
			}
			Blocklylog.push([command, id]);
			console.log("Blocklylog push = " + Blocklylog);//TEST
		}

		function turn(direction, id){
			var turncommand;
			if (direction) {
				// Right turn (clockwise).
				switch(hero.direction){
					case "right":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "down";
						turncommand = "facedown";
						break;
					case "left":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "up";
						turncommand = "faceup";
						break;
					case "up":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "right";
						turncommand = "faceright";
						break;
					case "down":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "left";
						turncommand = "faceleft";
						break;
				}
				Blocklylog.push([turncommand, id]);
			} else {
				// Left turn (counterclockwise).
				switch(hero.direction){
					case "right":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "up";
						turncommand = "faceup";
						break;
					case "left":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "down";
						turncommand = "facedown";
						break;
					case "up":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "left";
						turncommand = "faceleft";
						break;
					case "down":
						hero.pre.push([hero.x, hero.y, hero.direction]);
						hero.direction = "right";
						turncommand = "faceright";
						break;
				}
				Blocklylog.push([turncommand, id]);
			}
			console.log("Blocklylog push = " + Blocklylog);  //TEST
		}

		function destroy(id){
			var destroystatus = "destroyfail";
			var whichore = 0;
			for(var num = 1; num <= orenum; num++){
				var orex = eval("ore" + num + ".x");
				var orey = eval("ore" + num + ".y");
				var orelive = eval("ore" + num + ".live");
				//console.log("destroy ore status: " + orex + " " + orey + " " + orelive);
				switch (hero.direction) {
					case "right":
						if(hero.x + 50 == orex && hero.y == orey && orelive){
							destroystatus = "destroysuccess";
							eval("ore" + num + ".live = false");
							whichore = num;
						}
						break;
					case "left":
						if(hero.x - 50 == orex && hero.y == orey && orelive){
							destroystatus = "destroysuccess";
							eval("ore" + num + ".live = false");
							whichore = num;
						}
						break;
					case "up":
						if(hero.y - 50 == orey && hero.x == orex && orelive){
							destroystatus = "destroysuccess";
							eval("ore" + num + ".live = false");
							whichore = num;
						}
						break;
					case "down":
						if(hero.y + 50 == orey && hero.x == orex && orelive){
							destroystatus = "destroysuccess";
							eval("ore" + num + ".live = false");
							whichore = num;
						}
						break;
				}
			}
			hero.pre.push([hero.x, hero.y, hero.direction]);
			Blocklylog.push([destroystatus, id, whichore]);
			console.log("Blocklylog push = " + Blocklylog);  //TEST
		}

		function destroytree(id){
			var destroystatus = "destroyfail";
			var whichtree = 0;
			for(var num = 1; num <= treenum; num++){
				var treex = eval("tree" + num + ".x");
				var treey = eval("tree" + num + ".y");
				var treelive = eval("tree" + num + ".live");
				switch (hero.direction) {
					case "right":
						if(hero.x + 50 == treex && hero.y == treey && treelive){
							destroystatus = "destroysuccesstree";
							eval("tree" + num + ".live = false");
							whichtree = num;
						}
						break;
					case "left":
						if(hero.x - 50 == treex && hero.y == treey && treelive){
							destroystatus = "destroysuccesstree";
							eval("tree" + num + ".live = false");
							whichtree = num;
						}
						break;
					case "up":
						if(hero.y - 50 == treey && hero.x == treex && treelive){
							destroystatus = "destroysuccesstree";
							eval("tree" + num + ".live = false");
							whichtree = num;
						}
						break;
					case "down":
						if(hero.y + 50 == treey && hero.x == treex && treelive){
							destroystatus = "destroysuccesstree";
							eval("tree" + num + ".live = false");
							whichtree = num;
						}
						break;
				}
			}
			hero.pre.push([hero.x, hero.y, hero.direction]);
			Blocklylog.push([destroystatus, id, whichtree]);
			console.log("Blocklylog push = " + Blocklylog);  //TEST
		}

		function isPath(){
			var square;
			for(var i = 0; i < wall.length; i++){
				switch (hero.direction) {
					case "right":
						if(hero.x + 50 == wall[i][0] && hero.y == wall[i][1])
							square = true;
						break;
					case "left":
						if(hero.x - 50 == wall[i][0] && hero.y == wall[i][1])
							square = true;
						break;
					case "up":
						if(hero.y - 50 == wall[i][1] && hero.x == wall[i][0])
							square = true;
						break;
					case "down":
						if(hero.y + 50 == wall[i][1] && hero.x == wall[i][0])
							square = true;
						break;
				}
			}
			for(var num = 1; num <= orenum; num++){
				var orex = eval("ore" + num + ".x");
				var orey = eval("ore" + num + ".y");
				var orelive = eval("ore" + num + ".live");
				switch (hero.direction) {
					case "right":
						if(hero.x + 50 == orex && hero.y == orey && orelive)
							square = true;
						break;
					case "left":
						if(hero.x - 50 == orex && hero.y == orey && orelive)
							square = true;
						break;
					case "up":
						if(hero.y - 50 == orey && hero.x == orex && orelive)
							square = true;
						break;
					case "down":
						if(hero.y + 50 == orey && hero.x == orex && orelive)
							square = true;
						break;
				}
			}
			for(var num = 1; num <= treenum; num++){
				var treex = eval("tree" + num + ".x");
				var treey = eval("tree" + num + ".y");
				var treelive = eval("tree" + num + ".live");
				switch (hero.direction) {
					case "right":
						if(hero.x + 50 == treex && hero.y == treey && treelive)
							square = true;
						break;
					case "left":
						if(hero.x - 50 == treex && hero.y == treey && treelive)
							square = true;
						break;
					case "up":
						if(hero.y - 50 == treey && hero.x == treex && treelive)
							square = true;
						break;
					case "down":
						if(hero.y + 50 == treey && hero.x == treex && treelive)
							square = true;
						break;
				}
			}
			return !square;
		}

		function isLava(x, y){
			for(var num = 0; num < lava.length; num++){
				if(lava[num][0] == x && lava[num][1] == y){
					return true;
				}
			}
			return false;
		}

		function ifLavaForward(callback, id){
			for(var num = 0; num < lava.length; num++){
				switch (hero.direction) {
					case "right":
						if(lava[num][0] == hero.x+50 && lava[num][1] == hero.y){
							callback();
						}
						break;
					case "left":
						if(lava[num][0] == hero.x-50 && lava[num][1] == hero.y)
							callback();
						break;
					case "up":
						if(lava[num][0] == hero.x && lava[num][1] == hero.y-50)
							callback();
						break;
					case "down":
						if(lava[num][0] == hero.x+50 && lava[num][1] == hero.y+50)
							callback();
						break;
				}
			}
		}

		function floor_front(id){
			var floortype = "floorstone";
			hero.pre.push([hero.x, hero.y, hero.direction]);
				switch (hero.direction) {
					case "right":
						builtfloor.push([hero.x+50, hero.y]);
						if(isLava(hero.x+50, hero.y)){
							lava.shift();
						}
						break;
					case "left":
						builtfloor.push([hero.x-50, hero.y]);
						if(isLava(hero.x-50, hero.y)){
							lava.shift();
						}
						break;
					case "up":
						builtfloor.push([hero.x, hero.y-50]);
						if(isLava(hero.x, hero.y-50)){
							lava.shift();
						}
						break;
					case "down":
						builtfloor.push([hero.x, hero.y+50]);
						if(isLava(hero.x, hero.y+50)){
							lava.shift();
						}
						break;
				}

			Blocklylog.push([floortype, id]);
			console.log("Blocklylog push = " + Blocklylog);  //TEST
		}

		function animate(){
			var stop = false;
			var loglength = Blocklylog.length;
			var i = 0;
			function animateLoop(){
				setTimeout(function (){
					var logstring = Blocklylog[i].toString();
					var commandindex = logstring.indexOf(",");
					var checkcommand = logstring.substring(0,commandindex);

					var heroprestring = hero.pre[i].toString();
					var preindex1 = heroprestring.indexOf(",");
					var heroprex = heroprestring.substring(0,preindex1);
					var heroafterx = heroprestring.substring(preindex1 + 1);
					var preindex2 = heroafterx.indexOf(",");
					var heroprey = heroafterx.substring(0,preindex2);
					var heropredir = heroafterx.substring(preindex2 + 1);
					var heroprex50 = parseInt(heroprex);
					var heroprey50 = parseInt(heroprey);
					var handwavecount = 0;

					switch(checkcommand){
						//move right
						case "moveright":
						heroprex50 = parseInt(heroprex) + 50;
						console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
							var intervalId = setInterval(function draw(){
								heroprex++;
								drawNowBackgraound();
								context.drawImage(images.herorightImage, heroprex, heroprey);
								//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
								if(heroprex == heroprex50){
										if(isLava(heroprex, heroprey)){
											context.drawImage(images.herorightImageLava, heroprex, heroprey);
											setTimeout(function(){
												failcount = sessionStorage.getItem("12_fail");
												decidePrompt(failcount, attention);
												failcount++;
												sessionStorage.setItem("12_fail", failcount);
												stop = true;
												console.log(hero + "winpoint: " + winpoint + "fail number: " + failcount);
												clearInterval(intervalId);
											}, 500);
										}
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.speed);
							break;

						//move left
						case "moveleft":
						heroprex50 = parseInt(heroprex) - 50;
						console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
							var intervalId = setInterval(function draw(){
								heroprex--;
								drawNowBackgraound();
								context.drawImage(images.heroleftImage, heroprex, heroprey);
								//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
								if(heroprex == heroprex50){
									if(isLava(heroprex, heroprey)){
											context.drawImage(images.herorightImageLava, heroprex, heroprey);
											setTimeout(function(){
												failcount = sessionStorage.getItem("12_fail");
												decidePrompt(failcount, attention);
												failcount++;
												sessionStorage.setItem("12_fail", failcount);
												stop = true;
												console.log(hero + "winpoint: " + winpoint + "fail number: " + failcount);
												clearInterval(intervalId);
											}, 500);
										}
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.speed);
							break;

						//move up
						case "moveup":
						heroprey50 = parseInt(heroprey) - 50;
						console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
							var intervalId = setInterval(function draw(){
								heroprey--;
								drawNowBackgraound();
								context.drawImage(images.heroupImage, heroprex, heroprey);
								//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
								if(heroprey == heroprey50){
									if(isLava(heroprex, heroprey)){
											context.drawImage(images.herorightImageLava, heroprex, heroprey);
											setTimeout(function(){
												failcount = sessionStorage.getItem("12_fail");
												decidePrompt(failcount, attention);
												failcount++;
												sessionStorage.setItem("12_fail", failcount);
												stop = true;
												console.log(hero + "winpoint: " + winpoint + "fail number: " + failcount);
												clearInterval(intervalId);
											}, 500);
										}
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.speed);
							break;

						//move down
						case "movedown":
						heroprey50 = parseInt(heroprey) + 50;
						console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
							var intervalId = setInterval(function draw(){
								heroprey++;
								drawNowBackgraound();
								context.drawImage(images.herodownImage, heroprex, heroprey);
								//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
								if(heroprey == heroprey50){
									if(isLava(heroprex, heroprey)){
											context.drawImage(images.herorightImageLava, heroprex, heroprey);
											setTimeout(function(){
												failcount = sessionStorage.getItem("12_fail");
												decidePrompt(failcount, attention);
												failcount++;
												sessionStorage.setItem("12_fail", failcount);
												stop = true;
												console.log(hero + "winpoint: " + winpoint + "fail number: " + failcount);
												clearInterval(intervalId);
											}, 500);
										}
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.speed);
							break;

						//face right
						case "faceright":
							drawNowBackgraound();
							context.drawImage(images.herorightImage, heroprex, heroprey);
							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + "  " + heropredir + " -> " + "right");
							break;

						//face left
						case "faceleft":
							drawNowBackgraound();
							context.drawImage(images.heroleftImage, heroprex, heroprey);
							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + "  " + heropredir + " -> " + "left");
							break;

						//face up
						case "faceup":
							drawNowBackgraound();
							context.drawImage(images.heroupImage, heroprex, heroprey);
							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + "  " + heropredir + " -> " + "up");
							break;

						//face down
						case "facedown":
							drawNowBackgraound();
							context.drawImage(images.herodownImage, heroprex, heroprey);
							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + "  " + heropredir + " -> " + "down");
							break;

						//floor
						case "floorstone":
							builtcount++;
							var intervalId = setInterval(function draw(){
								drawNowBackgraound();
								if(handwavecount % 6 == 0){
									heroImageNow = eval('images.hero' + heropredir + 'Image');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 6 == 1){
									heroImageNow = eval('images.hero' + heropredir + 'Image1');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 6 == 2){
									heroImageNow = eval('images.hero' + heropredir + 'Image2');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 6 == 3){
									heroImageNow = eval('images.hero' + heropredir + 'Image3');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 6 == 4){
									heroImageNow = eval('images.hero' + heropredir + 'Image2');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 6 == 5){
									heroImageNow = eval('images.hero' + heropredir + 'Image1');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else{
									heroImageNow = eval('images.hero' + heropredir + 'Image0');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}
								handwavecount++;

								if(handwavecount == 7){
										drawNowBackgraound();
										heroImageNow = eval('images.hero' + heropredir + 'Image');
										context.drawImage(heroImageNow, heroprex, heroprey);
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.handspeed*2);

							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " floor built!");
							break;

						//destroy success
						case "destroysuccess":
							var aftercommand = logstring.substring(commandindex + 1);
							var commandindex2 = aftercommand.indexOf(",");
							var getwhichore = aftercommand.substring(commandindex2 + 1);

							var intervalId = setInterval(function draw(){
								drawNowBackgraound();

								if(handwavecount % 4 == 0){
									heroImageNow = eval('images.hero' + heropredir + 'Image');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 4 == 1){
									heroImageNow = eval('images.hero' + heropredir + 'Image1');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 4 == 2){
									heroImageNow = eval('images.hero' + heropredir + 'Image2');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else{
									heroImageNow = eval('images.hero' + heropredir + 'Image3');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}
								handwavecount++;

								if(handwavecount == 17){
										var orelive = eval("ore" + getwhichore + ".live");
										eval("ore" + getwhichore + ".show = " + orelive);  // show = live
										drawNowBackgraound();
										heroImageNow = eval('images.hero' + heropredir + 'Image');
										context.drawImage(heroImageNow, heroprex, heroprey);
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.handspeed);

							winpoint++;
							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + "handwave!");
							break;

						//destroy success tree
						case "destroysuccesstree":
							var aftercommand = logstring.substring(commandindex + 1);
							var commandindex2 = aftercommand.indexOf(",");
							var getwhichtree = aftercommand.substring(commandindex2 + 1);

							var intervalId = setInterval(function draw(){
								drawNowBackgraound();

								if(handwavecount % 4 == 0){
									heroImageNow = eval('images.hero' + heropredir + 'Image');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 4 == 1){
									heroImageNow = eval('images.hero' + heropredir + 'Image1');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 4 == 2){
									heroImageNow = eval('images.hero' + heropredir + 'Image2');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else{
									heroImageNow = eval('images.hero' + heropredir + 'Image3');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}
								handwavecount++;

								if(handwavecount == 17){
										var treelive = eval("tree" + getwhichtree + ".live");
										eval("tree" + getwhichtree + ".show = " + treelive);  // show = live
										drawNowBackgraound();
										heroImageNow = eval('images.hero' + heropredir + 'Image');
										context.drawImage(heroImageNow, heroprex, heroprey);
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.handspeed);

							winpoint++;
							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + "handwave!");
							break;

						//destroy fail
						case "destroyfail":
							var intervalId = setInterval(function draw(){
								drawNowBackgraound();
								if(handwavecount % 4 == 0){
									heroImageNow = eval('images.hero' + heropredir + 'Image');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 4 == 1){
									heroImageNow = eval('images.hero' + heropredir + 'Image1');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else if(handwavecount % 4 == 2){
									heroImageNow = eval('images.hero' + heropredir + 'Image2');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}else{
									heroImageNow = eval('images.hero' + heropredir + 'Image3');
									context.drawImage(heroImageNow, heroprex, heroprey);
								}
								handwavecount++;

								if(handwavecount == 17){
										clearInterval(intervalId);
								}
								return draw;
							}(), hero.handspeed);

							console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + "handwave!");
							break;

						//fail forward
						case "fail_forward":
							switch(heropredir){
								//fail move right
								case "right":
								heroprex50 = parseInt(heroprex) + 25;
								herobackx50 = parseInt(heroprex);
								console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
									var intervalId = setInterval(function draw(){
										heroprex++;
										drawNowBackgraound();
										context.drawImage(images.herorightImage, heroprex, heroprey);
										//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
										if(heroprex == heroprex50){
												clearInterval(intervalId);
												var intervalId2 = setInterval(function draw(){
													heroprex--;
													drawNowBackgraound();
													context.drawImage(images.herorightImage, heroprex, heroprey);
													//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
													if(heroprex == herobackx50){
															clearInterval(intervalId2);
													}
													return draw;
												}(), hero.speed);
										}
										return draw;
									}(), hero.speed);
									break;

								//fail move left
								case "left":
								heroprex50 = parseInt(heroprex) - 25;
								herobackx50 = parseInt(heroprex);
								console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
									var intervalId = setInterval(function draw(){
										heroprex--;
										drawNowBackgraound();
										context.drawImage(images.heroleftImage, heroprex, heroprey);
										//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
										if(heroprex == heroprex50){
												clearInterval(intervalId);
												var intervalId2 = setInterval(function draw(){
													heroprex++;
													drawNowBackgraound();
													context.drawImage(images.heroleftImage, heroprex, heroprey);
													//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
													if(heroprex == herobackx50){
															clearInterval(intervalId2);
													}
													return draw;
												}(), hero.speed);
										}
										return draw;
									}(), hero.speed);
									break;

								//fail move up
								case "up":
								heroprey50 = parseInt(heroprey) - 25;
								herobacky50 = parseInt(heroprey);
								console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
									var intervalId = setInterval(function draw(){
										heroprey--;
										drawNowBackgraound();
										context.drawImage(images.heroupImage, heroprex, heroprey);
										//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
										if(heroprey == heroprey50){
												clearInterval(intervalId);
												var intervalId2 = setInterval(function draw(){
													heroprey++;
													drawNowBackgraound();
													context.drawImage(images.heroupImage, heroprex, heroprey);
													//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
													if(heroprey == herobacky50){
															clearInterval(intervalId2);
													}
													return draw;
												}(), hero.speed);
										}
										return draw;
									}(), hero.speed);
									break;

								//fail move down
								case "down":
								heroprey50 = parseInt(heroprey) + 25;
								herobacky50 = parseInt(heroprey);
								console.log("animate: " + Blocklylog[i] + " ; " + heroprex + "," + heroprey + " -> " + heroprex50 + "," + heroprey50);
									var intervalId = setInterval(function draw(){
										heroprey++;
										drawNowBackgraound();
										context.drawImage(images.herodownImage, heroprex, heroprey);
										//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
										if(heroprey == heroprey50){
												clearInterval(intervalId);
												var intervalId2 = setInterval(function draw(){
													heroprey--;
													drawNowBackgraound();
													context.drawImage(images.herodownImage, heroprex, heroprey);
													//console.log("heroprex50 = "+heroprex50+","+hero.y+";pre x,y = "+heroprex+","+heroprey);
													if(heroprey == herobacky50){
															clearInterval(intervalId2);
													}
													return draw;
												}(), hero.handspeed);
										}
										return draw;
									}(), hero.speed);
									break;

							break;
						}
					}
					i++;
					if(i < loglength && !stop){
						animateLoop();
					}else if(winpoint == 9 && blocknum <= 16){
						setTimeout(function(){
							$( "#dialog" ).dialog( "open" );
							console.log(hero);
						}, 2000);
					}else if(!stop){
						setTimeout(function(){
							failcount = sessionStorage.getItem("12_fail");
							decidePrompt(failcount, attentionlevel);
							failcount++;
							sessionStorage.setItem("12_fail", failcount);
							console.log(hero + "winpoint: " + winpoint + "fail number: " + failcount);
						}, 2000);
					}
				},500)
			}
			animateLoop();
		}

		function decidePrompt(fail, attention){
			if(attention >= 10){
				if(fail == 0 || fail == null){
						$( "#dialog1-1" ).dialog( "open" );
				}
				if(fail == 1){
						$( "#dialog2-1" ).dialog( "open" );
				}
				if(fail >= 2){
						$( "#dialog3-1" ).dialog( "open" );
				}
			}else{
				if(fail == 0 || fail == null){
						$( "#dialog1-2" ).dialog( "open" );
				}
				if(fail == 1){
						$( "#dialog2-2" ).dialog( "open" );
				}
				if(fail >= 2){
						$( "#dialog3-2" ).dialog( "open" );
				}
			}
		}

		Blockly.Blocks['move_forward'] = {
			init: function() {
				this.appendDummyInput()
						.appendField("向前一格");
				this.setInputsInline(false);
				this.setPreviousStatement(true, null);
				this.setNextStatement(true, null);
				this.setColour(160);
				this.setTooltip('');
				this.setHelpUrl('http://www.example.com/');
			}
		};
		Blockly.JavaScript['move_forward'] = function(block) {
			// TODO: Assemble JavaScript into code variable.
			var code = 'moveForward(\'' + this.id + '\');\n';
			return code;
		};

		Blockly.Blocks['move_turnright'] = {
			init: function() {
				this.appendDummyInput()
						.appendField("向右轉");
				this.setInputsInline(false);
				this.setPreviousStatement(true, null);
				this.setNextStatement(true, null);
				this.setColour(160);
				this.setTooltip('');
				this.setHelpUrl('http://www.example.com/');
			}
		};
		Blockly.JavaScript['move_turnright'] = function(block) {
			// TODO: Assemble JavaScript into code variable.

			var code = 'turnRight(\'' + this.id + '\');\n';
			return code;

		};

		Blockly.Blocks['move_turnleft'] = {
			init: function() {
				this.appendDummyInput()
						.appendField("向左轉");
				this.setInputsInline(false);
				this.setPreviousStatement(true, null);
				this.setNextStatement(true, null);
				this.setColour(160);
				this.setTooltip('');
				this.setHelpUrl('http://www.example.com/');
			}
		};
		Blockly.JavaScript['move_turnleft'] = function(block) {
			// TODO: Assemble JavaScript into code variable.
			var code = 'turnLeft(\'' + this.id + '\');\n';
			return code;
		};

		Blockly.Blocks['action_floor'] = {
			init: function() {
				this.appendDummyInput()
						.appendField("覆蓋前面");
				this.setInputsInline(false);
				this.setPreviousStatement(true, null);
				this.setNextStatement(true, null);
				this.setColour(160);
				this.setTooltip('');
				this.setHelpUrl('http://www.example.com/');
			}
		};
		Blockly.JavaScript['action_floor'] = function(block) {
			// TODO: Assemble JavaScript into code variable.
			var code = 'floor_front(\'' + this.id + '\');\n';
			return code;
		};

		Blockly.Blocks['action_destroy'] = {
			init: function() {
				this.appendDummyInput()
						.appendField("摧毀石礦");
				this.setInputsInline(false);
				this.setPreviousStatement(true, null);
				this.setNextStatement(true, null);
				this.setColour(160);
				this.setTooltip('');
				this.setHelpUrl('http://www.example.com/');
			}
		};
		Blockly.JavaScript['action_destroy'] = function(block) {
			// TODO: Assemble JavaScript into code variable.
			var code = 'destroy(\'' + this.id + '\');\n';
			return code;
		};

		Blockly.Blocks['action_destroytree'] = {
			init: function() {
				this.appendDummyInput()
						.appendField("砍伐樹木");
				this.setInputsInline(false);
				this.setPreviousStatement(true, null);
				this.setNextStatement(true, null);
				this.setColour(160);
				this.setTooltip('');
				this.setHelpUrl('http://www.example.com/');
			}
		};
		Blockly.JavaScript['action_destroytree'] = function(block) {
			// TODO: Assemble JavaScript into code variable.
			var code = 'destroytree(\'' + this.id + '\');\n';
			return code;
		};

		Blockly.Blocks['general_if'] = {
			init: function() {
				this.appendDummyInput()
						.appendField("如果前方有岩漿");
				this.appendStatementInput("DO")
						.setCheck(null)
						.appendField("執行");
				this.setPreviousStatement(true, null);
				this.setNextStatement(true, null);
				this.setColour(290);
				this.setTooltip('');
				this.setHelpUrl('http://www.example.com/');
			}
		};

		Blockly.JavaScript['general_if'] = function(block) {
			var statements_do = Blockly.JavaScript.statementToCode(block, 'DO');
			//see this full if statement as a function
			var code = 'ifLavaForward(function() {\n' + statements_do + '}, \'block_id_' + this.id + '\');\n';
			return code;
		};

    var workspace = Blockly.inject('blocklyDiv',
        {media: './media/', toolbox: document.getElementById('toolbox'), trashcan: true});

		var blocknum;
    function onchange() {
			blocknum = workspace.getAllBlocks().length;
      document.getElementById('capacity').innerHTML = blocknum;
    }

    workspace.addChangeListener(onchange);

		var attentionlevel = 0;
		function runCode() {
			Blocklylog = [];
			setTimeout(function(){
				if(blocknum != 0 && Blocklylog != ""){
					document.getElementById('count').disabled=true;
					document.getElementById('count').style.backgroundColor = "grey";
				}
			}, 500);
			failcount = sessionStorage.getItem("12_fail");
			var blocks = workspace.getAllBlocks();
			$.getJSON('./stop_record.php?callback=?', "stoptime=" + getDateTimeFormate() + "&mid=" + mid + "&fail=" + failcount + "&blocks=" + blocks,  function(res){
				attentionlevel = res.total_att;
			});
			var code = Blockly.JavaScript.workspaceToCode(workspace);
			try {
				eval(code);
			} catch (e) {
				alert(e);
			}
			animate();
		}
  </script>

	<div id="dialog">恭喜過關!</div>

	<div id="dialog1-1">
		<br/>
		<div>
			<div style="display:inline-block; margin-right:10px;">觀察其中的</div><div id="drop1-1-1" class="dropdiv" style="display:inline-block;">規律</div>
		</div><br/>
		<div>
			<div style="display:inline-block; margin-right:10px;">並透過</div><div id="drop1-1-2" class="dropdiv" style="display:inline-block;">重複</div>
		</div><br/>
		<div>來完成任務</div>
		<div id="drag1-1-1" class="dragdiv">規律</div>
		<div id="drag1-1-2" class="dragdiv">重複</div>
	</div>
	<div id="dialog2-1">
		<div>
			<div id="drop2-1-1" class="dropdiv" style="display:inline-block; margin-right:10px;">重複</div><div style="display:inline-block;">中</div>
		</div><br/>
		<div>會需要組合先前學過的</div><br/>
		<div id="drop2-1-2" class="dropdiv">基本指令</div><br/>
		<div>與</div><br/>
		<div id="drop2-1-3" class="dropdiv">如果</div>
		<div id="drag2-1-1" class="dragdiv">重複</div>
		<div id="drag2-1-2" class="dragdiv">基本指令</div>
		<div id="drag2-1-3" class="dragdiv">如果</div>
	</div>
	<div id="dialog3-1">完整作法如下<br/><br/><img src="./img/normalprompt/Answer_3_12.png" /></div>

	<div id="dialog1-2">
		<br/>
		<div>
			<div style="display:inline-block; margin-right:10px;">觀察其中的</div><div id="drop1-2-1" class="dropdiv2" style="display:inline-block;">規律</div>
		</div><br/>
		<div>
			<div style="display:inline-block; margin-right:10px;">並透過</div><div id="drop1-2-2" class="dropdiv2" style="display:inline-block;">重複</div>
		</div><br/>
		<div>來完成任務</div>
		<div id="drag1-2-1" class="dragdiv2">規律</div>
		<div id="drag1-2-2" class="dragdiv2">重複</div>
	</div>
	<div id="dialog2-2">
		<div>
			<div id="drop2-2-1" class="dropdiv2" style="display:inline-block; margin-right:10px;">重複</div><div style="display:inline-block;">中</div>
		</div><br/>
		<div>會需要組合先前學過的</div><br/>
		<div id="drop2-2-2" class="dropdiv2">基本指令</div><br/>
		<div>與</div><br/>
		<div id="drop2-2-3" class="dropdiv2">如果</div>
		<div id="drag2-2-1" class="dragdiv2">重複</div>
		<div id="drag2-2-2" class="dragdiv2">基本指令</div>
		<div id="drag2-2-3" class="dragdiv2">如果</div>
	</div>
	<div id="dialog3-2">完整作法如下<br/><br/><img src="./img/powerprompt/level_b12_3.gif" /></div>

	<script>
	var mid = sessionStorage.getItem("mId");
	var url = location.href;
	var whichlevel = 12;
	var nextlevel = parseInt(whichlevel) + 1;
  var dropnum = 0;
	var level_prompt1 = [0, 2, 2, 2, 3, 2, 3, 2, 3, 3, 2, 3, 2, 3];
	var level_prompt2 = [0, 2, 3, 4, 4, 3, 3, 2, 2, 3, 2, 2, 3, 5];

	function getDateTimeFormate() {
		now = new Date();
		year = "" + now.getFullYear();
		month = "" + (now.getMonth() + 1); if (month.length == 1) { month = "0" + month; }
		day = "" + now.getDate(); if (day.length == 1) { day = "0" + day; }
		hour = "" + now.getHours(); if (hour.length == 1) { hour = "0" + hour; }
		minute = "" + now.getMinutes(); if (minute.length == 1) { minute = "0" + minute; }
		second = "" + now.getSeconds(); if (second.length == 1) { second = "0" + second; }
		return year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second;
	}

	$("#dialog").dialog({
			autoOpen: false,
			height: 200,
			width: 500,
			modal: true,
			resizable: false,
			closeOnEscape: false,
			buttons: {
					'下一關': function() {
							$(this).dialog('close');
							$.getJSON('./start_record.php?callback=?', "starttime=" + getDateTimeFormate() + "&group=2&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
							location.href = "./Level_" +  nextlevel  + "B.html";
					}
			},
			open: function() {
				var showtime = getDateTimeFormate();
				$.getJSON('./show_record.php?callback=?', "showtime=" + showtime + "&group=1&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
				var audio = document.getElementById("winAudio");
				setTimeout(function () {
					audio.play();
				}, 150);
			}
	});
	$("#dialog1-1").dialog({
			autoOpen: false,
			height: 500,
			width: 700,
			modal: true,
			resizable: false,
			closeOnEscape: false,
			buttons: {
					'我看完提示了': function() {
							if(dropnum == level_prompt1[whichlevel]){
								$(this).html("<div style='line-height:360px; font-size: 44px;'>將剛剛做的套用到解題上吧!</div>");
								$('.ui-dialog-buttonpane').button().hide();
								var audio = document.getElementById("correctAudio");
								audio.play();
								setTimeout(function(){
									$.getJSON('./start_record.php?callback=?', "starttime=" + getDateTimeFormate() + "&group=2&level=" +  whichlevel  + "&mid=" + mid,  function(res){});
									location.reload();
								}, 3000);
							}else{
								$("#dialog1-1").append( "<br/><span style='color:red;  font-size:16px;'>請放入所有方塊</span>" );
							}
					}
			},
			open: function() {
				var showtime = getDateTimeFormate();
				$.getJSON('./show_record.php?callback=?', "showtime=" + showtime + "&group=1&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
				var audio = document.getElementById("failureAudio");
				setTimeout(function () {
					audio.play();
				}, 150);
				$(".ui-dialog-buttonpane button:contains('我看完提示了')").button('disable');
			}
	});
	$("#dialog2-1").dialog({
			autoOpen: false,
			height: 550,
			width: 700,
			modal: true,
			resizable: false,
			closeOnEscape: false,
			buttons: {
					'我看完提示了': function() {
							if(dropnum == level_prompt2[whichlevel]){
								$(this).html("<div style='line-height:360px; font-size: 44px;'>將剛剛做的套用到解題上吧!</div>");
								$('.ui-dialog-buttonpane').button().hide();
								var audio = document.getElementById("correctAudio");
								audio.play();
								setTimeout(function(){
									$.getJSON('./start_record.php?callback=?', "starttime=" + getDateTimeFormate() + "&group=2&level=" +  whichlevel  + "&mid=" + mid,  function(res){});
									location.reload();
								}, 3000);
							}else{
								$("#dialog2-1").append( "<br/><span style='color:red;  font-size:16px;'>請放入所有方塊</span>" );
							}
					}
			},
			open: function() {
				var showtime = getDateTimeFormate();
				$.getJSON('./show_record.php?callback=?', "showtime=" + showtime + "&group=1&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
				var audio = document.getElementById("failureAudio");
				setTimeout(function () {
					audio.play();
				}, 150);
				$(".ui-dialog-buttonpane button:contains('我看完提示了')").button('disable');
			}
	});
	$("#dialog3-1").dialog({
			autoOpen: false,
			width: 350,
			modal: true,
			resizable: false,
			closeOnEscape: false,
			buttons: {
					'我看完提示了': function() {
							$(this).dialog('close');
							$.getJSON('./start_record.php?callback=?', "starttime=" + getDateTimeFormate() + "&group=2&level=" +  whichlevel  + "&mid=" + mid,  function(res){});
							location.reload();
					}
			},
			open: function() {
				var showtime = getDateTimeFormate();
				$.getJSON('./show_record.php?callback=?', "showtime=" + showtime + "&group=1&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
				var audio = document.getElementById("failureAudio");
				setTimeout(function () {
					audio.play();
				}, 150);
			}
	});

	$("#dialog1-2").dialog({
			autoOpen: false,
			height: 500,
			width: 700,
			modal: true,
			resizable: false,
			closeOnEscape: false,
			buttons: {
					'我看完提示了': function() {
						if(dropnum == level_prompt1[whichlevel]){
							$(this).html("<div id='correctdiv' style='line-height:360px; font-size: 40px; color: #F44336'>將剛剛做的套用到解題上吧!</div>");
							$('.ui-dialog-buttonpane').button().hide();
							$( "#correctdiv" ).animate({
								fontSize: "52px",
							}, 500 );
							var preaudio = document.getElementById("level_12_1Audio");
							preaudio.pause();
							var audio = document.getElementById("correctAudio");
							audio.play();
							setTimeout(function(){
								$.getJSON('./start_record.php?callback=?', "starttime=" + getDateTimeFormate() + "&group=2&level=" +  whichlevel  + "&mid=" + mid,  function(res){});
								location.reload();
							}, 3000);
						}else{
							$("#dialog1-2").append( "<br/><span style='color:red;  font-size:16px;'>請放入所有方塊</span>" );
						}
					}
			},
			open: function() {
				var showtime = getDateTimeFormate();
				$.getJSON('./show_record.php?callback=?', "showtime=" + showtime + "&group=1&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
				$(".ui-dialog-buttonpane button:contains('我看完提示了')").button('disable');
				var audio = document.getElementById("level_12_1Audio");
				setTimeout(function () {
					audio.play();
				}, 150);
			}
	});
	$("#dialog2-2").dialog({
			autoOpen: false,
			height: 550,
			width: 700,
			modal: true,
			resizable: false,
			closeOnEscape: false,
			buttons: {
					'我看完提示了': function() {
							if(dropnum == level_prompt2[whichlevel]){
								$(this).html("<div id='correctdiv' style='line-height:360px; font-size: 40px; color: #F44336'>將剛剛做的套用到解題上吧!</div>");
								$('.ui-dialog-buttonpane').button().hide();
								$( "#correctdiv" ).animate({
									fontSize: "52px",
								}, 500 );
								var preaudio = document.getElementById("level_12_2Audio");
								preaudio.pause();
								var audio = document.getElementById("correctAudio");
								audio.play();
								setTimeout(function(){
									$.getJSON('./start_record.php?callback=?', "starttime=" + getDateTimeFormate() + "&group=2&level=" +  whichlevel  + "&mid=" + mid,  function(res){});
									location.reload();
								}, 3000);
							}else{
								$("#dialog2-2").append( "<br/><span style='color:red;  font-size:16px;'>請放入所有方塊</span>" );
							}
					}
			},
			open: function() {
				var showtime = getDateTimeFormate();
				$.getJSON('./show_record.php?callback=?', "showtime=" + showtime + "&group=1&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
				$(".ui-dialog-buttonpane button:contains('我看完提示了')").button('disable');
				var audio = document.getElementById("level_12_2Audio");
				setTimeout(function () {
					audio.play();
				}, 150);
			}
	});
	$("#dialog3-2").dialog({
			autoOpen: false,
			width: 350,
			modal: true,
			resizable: false,
			closeOnEscape: false,
			buttons: {
					'我看完提示了': function() {
							$(this).dialog('close');
							$.getJSON('./start_record.php?callback=?', "starttime=" + getDateTimeFormate() + "&group=2&level=" +  whichlevel  + "&mid=" + mid,  function(res){});
							location.reload();
					}
			},
			open: function() {
				var showtime = getDateTimeFormate();
				$.getJSON('./show_record.php?callback=?', "showtime=" + showtime + "&group=1&level=" +  nextlevel  + "&mid=" + mid,  function(res){});
				var audio = document.getElementById("level_12_3Audio");
				setTimeout(function () {
					audio.play();
				}, 150);
			}
	});

	$(".ui-dialog-titlebar").hide();
	$(".ui-dialog-content").css({"font-size": +24+"px"});
	$.ui.dialog.prototype._focusTabbable = $.noop;
	$(".ui-dialog-content #drag2-1-1").css({"left": +185+"px"});
	$(".ui-dialog-content #drag2-1-2").css({"left": +310+"px"});
	$(".ui-dialog-content #drag2-1-3").css({"left": +435+"px"});
	$(".ui-dialog-content #drag2-2-1").css({"left": +185+"px"});
	$(".ui-dialog-content #drag2-2-2").css({"left": +310+"px"});
	$(".ui-dialog-content #drag2-2-3").css({"left": +435+"px"});

  $(function() {

    $( "#drag1-1-1" ).draggable({ containment: "parent" });
    $( "#drag1-1-2" ).draggable({ containment: "parent" });
		$( "#drag2-1-1" ).draggable({ containment: "parent" });
    $( "#drag2-1-2" ).draggable({ containment: "parent" });
		$( "#drag2-1-3" ).draggable({ containment: "parent" });
		$( "#drag1-2-1" ).draggable({ containment: "parent" });
		$( "#drag1-2-2" ).draggable({ containment: "parent" });
		$( "#drag2-2-1" ).draggable({ containment: "parent" });
		$( "#drag2-2-2" ).draggable({ containment: "parent" });
		$( "#drag2-2-3" ).draggable({ containment: "parent" });

    $( "#drop1-1-1" ).droppable({
      accept: "#drag1-1-1",
      tolerance: "pointer",
      drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
        $( "#drag1-1-1" ).draggable( "disable" );
        $( "#drag1-1-1" ).position({
          my: "center",
          at: "center",
          of: "#drop1-1-1"
        });
        $( this ).addClass( "ui-state-highlight" ).html( "" );
        dropnum++;
				if(dropnum == level_prompt1[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
      }
    });
    $( "#drop1-1-2" ).droppable({
      accept: "#drag1-1-2",
      tolerance: "pointer",
      drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
        $( "#drag1-1-2" ).draggable( "disable" );
        $( "#drag1-1-2" ).position({
          my: "center",
          at: "center",
          of: "#drop1-1-2"
        });
        $( this ).addClass( "ui-state-highlight" ).html( "" );
        dropnum++;
				if(dropnum == level_prompt1[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
      }
    });

		$( "#drop2-1-1" ).droppable({
      accept: "#drag2-1-1",
      tolerance: "pointer",
      drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
        $( "#drag2-1-1" ).draggable( "disable" );
        $( "#drag2-1-1" ).position({
          my: "center",
          at: "center",
          of: "#drop2-1-1"
        });
        $( this ).addClass( "ui-state-highlight" ).html( "" );
        dropnum++;
				if(dropnum == level_prompt2[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
      }
    });
    $( "#drop2-1-2" ).droppable({
      accept: "#drag2-1-2",
      tolerance: "pointer",
      drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
        $( "#drag2-1-2" ).draggable( "disable" );
        $( "#drag2-1-2" ).position({
          my: "center",
          at: "center",
          of: "#drop2-1-2"
        });
        $( this ).addClass( "ui-state-highlight" ).html( "" );
        dropnum++;
				if(dropnum == level_prompt2[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
      }
    });
    $( "#drop2-1-3" ).droppable({
      accept: "#drag2-1-3",
      tolerance: "pointer",
      drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
        $( "#drag2-1-3" ).draggable( "disable" );
        $( "#drag2-1-3" ).position({
          my: "center",
          at: "center",
          of: "#drop2-1-3"
        });
        $( this ).addClass( "ui-state-highlight" ).html( "" );
        dropnum++;
				if(dropnum == level_prompt2[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
      }
    });

		$( "#drop1-2-1" ).droppable({
			accept: "#drag1-2-1",
			tolerance: "pointer",
			drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
				$( "#drag1-2-1" ).draggable( "disable" );
				$( "#drag1-2-1" ).position({
					my: "center",
					at: "center",
					of: "#drop1-2-1"
				});
				$( this ).addClass( "ui-state-highlight" ).html( "" );
				dropnum++;
				$( "#drag1-2-1" ).animate({
					width: "120px",
					height: "50px",
					left: "-=10px",
					top: "-=10px",
					fontSize: "26px",
					borderWidth: "5px"
				}, 1000 );
				if(dropnum == level_prompt1[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
			}
		});
		$( "#drop1-2-2" ).droppable({
			accept: "#drag1-2-2",
			tolerance: "pointer",
			drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
				$( "#drag1-2-2" ).draggable( "disable" );
				$( "#drag1-2-2" ).position({
					my: "center",
					at: "center",
					of: "#drop1-2-2"
				});
				$( this ).addClass( "ui-state-highlight" ).html( "" );
				dropnum++;
				$( "#drag1-2-2" ).animate({
					width: "120px",
					height: "50px",
					left: "-=10px",
					top: "-=10px",
					fontSize: "26px",
					borderWidth: "5px"
				}, 1000 );
				if(dropnum == level_prompt1[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
			}
		});

		$( "#drop2-2-1" ).droppable({
			accept: "#drag2-2-1",
			tolerance: "pointer",
			drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
				$( "#drag2-2-1" ).draggable( "disable" );
				$( "#drag2-2-1" ).position({
					my: "center",
					at: "center",
					of: "#drop2-2-1"
				});
				$( this ).addClass( "ui-state-highlight" ).html( "" );
				dropnum++;
				$( "#drag2-2-1" ).animate({
					width: "120px",
					height: "50px",
					left: "-=10px",
					top: "-=10px",
					fontSize: "26px",
					borderWidth: "5px"
				}, 1000 );
				if(dropnum == level_prompt2[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
			}
		});
		$( "#drop2-2-2" ).droppable({
			accept: "#drag2-2-2",
			tolerance: "pointer",
			drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
				$( "#drag2-2-2" ).draggable( "disable" );
				$( "#drag2-2-2" ).position({
					my: "center",
					at: "center",
					of: "#drop2-2-2"
				});
				$( this ).addClass( "ui-state-highlight" ).html( "" );
				dropnum++;
				$( "#drag2-2-2" ).animate({
					width: "120px",
					height: "50px",
					left: "-=10px",
					top: "-=10px",
					fontSize: "26px",
					borderWidth: "5px"
				}, 1000 );
				if(dropnum == level_prompt2[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
			}
		});
		$( "#drop2-2-3" ).droppable({
			accept: "#drag2-2-3",
			tolerance: "pointer",
			drop: function( event, ui ) {
				var audio = document.getElementById("clickAudio");
				audio.play();
				$( "#drag2-2-3" ).draggable( "disable" );
				$( "#drag2-2-3" ).position({
					my: "center",
					at: "center",
					of: "#drop2-2-3"
				});
				$( this ).addClass( "ui-state-highlight" ).html( "" );
				dropnum++;
				$( "#drag2-2-3" ).animate({
					width: "120px",
					height: "50px",
					left: "-=10px",
					top: "-=10px",
					fontSize: "26px",
					borderWidth: "5px"
				}, 1000 );
				if(dropnum == level_prompt2[whichlevel]){
					$(".ui-dialog-buttonpane button:contains('我看完提示了')").button("enable");
				}
			}
		});

  });

	function blinker() {
	    $('.dropdiv2').fadeOut(1000);
	    $('.dropdiv2').fadeIn(1000);
	}

	setInterval(blinker, 2000);

  </script>
</html>
